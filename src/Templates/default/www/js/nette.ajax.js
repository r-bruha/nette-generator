!function(t,e,n){if("function"!=typeof e)return console.error("nette.ajax.js: jQuery is missing, load it please");var i=function(){var i={self:this,initialized:!1,contexts:{},on:{init:{},load:{},prepare:{},before:{},start:{},success:{},complete:{},error:{}},fire:function(){var t=!0,r=Array.prototype.slice.call(arguments),o=r.shift(),a="string"==typeof o?o:o.name,f="object"==typeof o?o.off||{}:{};return r.push(i.self),e.each(i.on[a],function(o,a){if(a===n||-1!==e.inArray(o,f))return!0;var s=a.apply(i.contexts[o],r);return t=s===n||s}),t},requestHandler:function(t){var e=i.self.ajax({},this,t);return e&&e._returnFalse?!1:void 0},ext:function(t,r,o){for(;!o;)o="ext_"+Math.random(),i.contexts[o]&&(o=n);e.each(t,function(t,e){i.on[t][o]=e}),i.contexts[o]=e.extend(r?r:{},{name:function(){return o},ext:function(t,e){var n=i.contexts[t];if(!n&&e)throw"Extension '"+this.name()+"' depends on disabled extension '"+t+"'.";return n}})}};this.ext=function(t,r,o){if("object"==typeof t)i.ext(t,r);else{if(r===n)return i.contexts[t];if(r){if("string"==typeof t&&i.contexts[t]!==n)throw"Cannot override already registered nette-ajax extension '"+t+"'.";i.ext(r,o,t)}else e.each(["init","load","prepare","before","start","success","complete","error"],function(e,r){i.on[r][t]=n}),i.contexts[t]=n}return this},this.init=function(t,e){if(i.initialized)throw"Cannot initialize nette-ajax twice.";if("function"==typeof t)this.ext("init",null),this.ext("init",{load:t},e);else if("object"==typeof t)this.ext("init",null),this.ext("init",t,e);else if(t!==n)throw"Argument of init() can be function or function-hash only.";return i.initialized=!0,i.fire("init"),this.load(),this},this.load=function(){return i.fire("load",i.requestHandler),this},this.ajax=function(r,o,a){if("string"===e.type(r)&&(r={url:r}),!r.nette&&o&&a){var f,s=e(o),u=r.nette={e:a,ui:o,el:s,isForm:s.is("form"),isSubmit:s.is("input[type=submit]")||s.is("button[type=submit]"),isImage:s.is("input[type=image]"),form:null};if(u.isSubmit||u.isImage?u.form=u.el.closest("form"):u.isForm&&(u.form=u.el),r.url||(r.url=u.form?u.form.attr("action")||t.location.pathname+t.location.search:o.href),r.type||(r.type=u.form?u.form.attr("method"):"get"),s.is("[data-ajax-off]")){var c=s.attr("data-ajax-off");0===c.indexOf("[")?r.off=s.data("ajaxOff"):-1!==c.indexOf(",")?r.off=c.split(","):-1!==c.indexOf(" ")?r.off=c.split(" "):r.off=c,"string"==typeof r.off&&(r.off=[r.off]),r.off=e.grep(e.each(r.off,function(t){return e.trim(t)}),function(t){return t.length})}}return i.fire({name:"prepare",off:r.off||{}},r),r.prepare&&r.prepare(r),f=r.beforeSend,r.beforeSend=function(t,e){var r=i.fire({name:"before",off:e.off||{}},t,e);return(r||r===n)&&f&&(r=f(t,e)),r},this.handleXHR(e.ajax(r),r)},this.handleXHR=function(t,e){return e=e||{},!t||"undefined"!=typeof t.statusText&&"canceled"===t.statusText||(t.done(function(t,n,r){i.fire({name:"success",off:e.off||{}},t,n,r,e)}).fail(function(t,n,r){i.fire({name:"error",off:e.off||{}},t,n,r,e)}).always(function(t,n){i.fire({name:"complete",off:e.off||{}},t,n,e)}),i.fire({name:"start",off:e.off||{}},t,e),e.start&&e.start(t,e)),t}};e.nette=new(e.extend(i,e.nette?e.nette:{})),e.fn.netteAjax=function(t,n){return e.nette.ajax(n||{},this[0],t)},e.fn.netteAjaxOff=function(){return this.off(".nette")},e.nette.ext("validation",{before:function(t,i){if(!i.nette)return!0;var r=i.nette,o=r.e,a=e.extend(this.defaults,i.validate||function(){if(r.el.is("[data-ajax-validate]")){var t=r.el.data("ajaxValidate");return t===!1?{keys:!1,url:!1,form:!1}:"object"==typeof t?t:void 0}}()||{}),f=!1;if(r.el.attr("data-ajax-pass")!==n&&(f=r.el.data("ajaxPass"),f="bool"==typeof f?f:!0),a.keys){var s=o.button||o.ctrlKey||o.shiftKey||o.altKey||o.metaKey;if(r.form){if(s&&r.isSubmit)return this.explicitNoAjax=!0,!1;if(r.isForm&&this.explicitNoAjax)return this.explicitNoAjax=!1,!1}else if(s)return!1}if(a.form&&r.form){(r.isSubmit||r.isImage)&&(r.form.get(0)["nette-submittedBy"]=r.el.get(0));var u;if("undefined"==typeof Nette.version||"2.3"==Nette.version){var c=this.ie();u=r.form.get(0).onsubmit&&r.form.get(0).onsubmit("undefined"!=typeof c&&9>c?n:o)===!1}else u=(r.form.get(0).onsubmit?r.form.triggerHandler("submit"):Nette.validateForm(r.form.get(0)))===!1;if(u)return o.stopImmediatePropagation(),o.preventDefault(),!1}if(a.url){var l=r.form?i.url:r.el.attr("href");if(/(?:^[a-z][a-z0-9+.-]*:|\/\/)/.test(l)){var p=new URL(l);if(/:|^#/.test(p.pathname+p.search+p.hash))return!1}else if(/:|^#/.test(l))return!1}return f||(o.stopPropagation(),o.preventDefault(),t._returnFalse=!0),!0}},{defaults:{keys:!0,url:!0,form:!0},explicitNoAjax:!1,ie:function(t){for(var e=3,n=document.createElement("div"),i=n.getElementsByTagName("i");n.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->",i[0];);return e>4?e:t}}),e.nette.ext("forms",{init:function(){var e;t.Nette&&(e=this.ext("snippets"))&&e.after(function(e){e.find("form").each(function(){t.Nette.initForm(this)})})},prepare:function(n){var i=n.nette;if(i&&i.form){var r=i.e,o=n.data||{},a={};if(i.isSubmit)a[i.el.attr("name")]=i.el.val()||"";else if(i.isImage){var f=i.el.offset(),s=i.el.attr("name"),u=[Math.max(0,r.pageX-f.left),Math.max(0,r.pageY-f.top)];-1!==s.indexOf("[",0)?a[s]=u:(a[s+".x"]=u[0],a[s+".y"]=u[1])}var c=i.form.attr("method");if(c&&"post"===c.toLowerCase()&&"FormData"in t){var l=new FormData(i.form[0]);for(var p in a)l.append(p,a[p]);if("string"!=typeof o)for(var p in o)l.append(p,o[p]);n.data=l,n.processData=!1,n.contentType=!1}else"string"!=typeof o&&(o=e.param(o)),a=e.param(a),n.data=i.form.serialize()+(a?"&"+a:"")+"&"+o}}}),e.nette.ext("snippets",{success:function(t){t.snippets&&this.updateSnippets(t.snippets)}},{beforeQueue:e.Callbacks(),afterQueue:e.Callbacks(),completeQueue:e.Callbacks(),before:function(t){this.beforeQueue.add(t)},after:function(t){this.afterQueue.add(t)},complete:function(t){this.completeQueue.add(t)},updateSnippets:function(t,n){var i=this,r=[];for(var o in t){var a=this.getElement(o);a.get(0)&&r.push(a.get(0)),this.updateSnippet(a,t[o],n)}e(r).promise().done(function(){i.completeQueue.fire()})},updateSnippet:function(t,e,n){t.is("title")?document.title=e:(this.beforeQueue.fire(t),this.applySnippet(t,e,n),this.afterQueue.fire(t))},getElement:function(t){return e("#"+this.escapeSelector(t))},applySnippet:function(t,e,n){!n&&t.is("[data-ajax-append]")?t.append(e):!n&&t.is("[data-ajax-prepend]")?t.prepend(e):(t.html()!=e||/<[^>]*script/.test(e))&&t.html(e)},escapeSelector:function(t){return t.replace(/[\!"#\$%&'\(\)\*\+,\.\/:;<=>\?@\[\\\]\^`\{\|\}~]/g,"\\$&")}}),e.nette.ext("redirect",{success:function(e){return e.redirect?(t.location.href=e.redirect,!1):void 0}}),e.nette.ext("state",{success:function(t){t.state&&(this.state=t.state)}},{state:null}),e.nette.ext("unique",{start:function(t){this.xhr&&this.xhr.abort(),this.xhr=t},complete:function(){this.xhr=null}},{xhr:null}),e.nette.ext("abort",{init:function(){e("body").keydown(e.proxy(function(t){this.xhr&&"27"===t.keyCode.toString()&&!(t.ctrlKey||t.shiftKey||t.altKey||t.metaKey)&&this.xhr.abort()},this))},start:function(t){this.xhr=t},complete:function(){this.xhr=null}},{xhr:null}),e.nette.ext("load",{success:function(){e.nette.load()}}),e.nette.ext("init",{load:function(t){e(this.linkSelector).off("click.nette",t).on("click.nette",t),e(this.formSelector).off("submit.nette",t).on("submit.nette",t).off("click.nette",":image",t).on("click.nette",":image",t).off("click.nette",":submit",t).on("click.nette",":submit",t),e(this.buttonSelector).closest("form").off("click.nette",this.buttonSelector,t).on("click.nette",this.buttonSelector,t)}},{linkSelector:"a.ajax",formSelector:"form.ajax",buttonSelector:'input.ajax[type="submit"], button.ajax[type="submit"], input.ajax[type="image"]'})}(window,window.jQuery);